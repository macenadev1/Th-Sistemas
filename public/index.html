<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDV Bomboniere Dois Primos</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1 style="font-size: 36px; font-weight: 700;">üõí PDV Bomboniere Dois Primos</h1>
                <div style="display: flex; gap: 15px; align-items: center; margin-top: 8px;">
                    <span id="statusBadge" class="status-badge offline">‚óè Conectando...</span>
                    <span id="caixaStatus" class="status-badge" style="background: #dc3545;">üîí Caixa Fechado</span>
                </div>
            </div>
            <div style="display: flex; gap: 10px;">
                <button onclick="abrirConfiguracoes()" style="
                    background: #6c757d;
                    color: #fff;
                    border: none;
                    padding: 12px 20px;
                    border-radius: 8px;
                    font-size: 16px;
                    font-weight: bold;
                    cursor: pointer;
                    transition: all 0.2s;
                " onmouseover="this.style.background='#5a6268'" onmouseout="this.style.background='#6c757d'" title="Configura√ß√µes [F8]">
                    ‚öôÔ∏è Configura√ß√µes [F8]
                </button>
                <button onclick="abrirMenuCaixa()" style="
                    background: #ffc107;
                    color: #000;
                    border: none;
                    padding: 12px 20px;
                    border-radius: 8px;
                    font-size: 16px;
                    font-weight: bold;
                    cursor: pointer;
                    transition: all 0.2s;
                " onmouseover="this.style.background='#e0a800'" onmouseout="this.style.background='#ffc107'">
                    üí∞ Gerenciar Caixa [F7]
                </button>
            </div>
        </div>

        <div class="main-content">
            <div class="left-panel">
                <div class="search-section">
                    <!-- Campo de Quantidade -->
                    <div style="margin-bottom: 15px;">
                        <label class="search-label" style="font-size: 18px; font-weight: 700; color: #333; margin-bottom: 10px;">üì¶ Quantidade:</label>
                        <input 
                            type="number" 
                            id="quantidadeInput" 
                            min="1"
                            value="1"
                            placeholder="1"
                            style="font-size: 28px; padding: 15px; border: 4px solid #28a745; border-radius: 10px; width: 150px; text-align: center; font-weight: bold;">
                        <span style="margin-left: 15px; font-size: 16px; color: #666;">Use <kbd style="background: #28a745; color: white; padding: 4px 8px; border-radius: 4px; font-size: 14px;">+</kbd> e <kbd style="background: #28a745; color: white; padding: 4px 8px; border-radius: 4px; font-size: 14px;">-</kbd> para ajustar</span>
                    </div>
                    
                    <label class="search-label" style="font-size: 20px; font-weight: 700; color: #333; margin-bottom: 15px;">üîç C√≥digo de Barras:</label>
                    <div class="search-box">
                        <input 
                            type="text" 
                            id="searchInput" 
                            placeholder="Escaneie o produto..."
                            autofocus
                            autocomplete="off"
                            style="font-size: 24px; padding: 20px; border: 4px solid #667eea;">
                    </div>
                </div>

                <div class="items-list">
                    <h3 style="font-size: 24px; font-weight: 700; color: #333;">üìã Itens da Venda (0)</h3>
                    <div id="cartItems">
                        <div class="empty-cart">
                            <div class="empty-cart-icon" style="font-size: 80px;">üõí</div>
                            <p style="font-size: 20px; color: #666; font-weight: 500;">Nenhum item</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="right-panel">
                <div class="total-section">
                    <div class="total-row">
                        <span class="total-label" style="font-size: 20px; font-weight: 600;">Quantidade:</span>
                        <span class="total-value" id="totalItems" style="font-size: 24px; font-weight: 700;">0</span>
                    </div>
                    <div class="total-row">
                        <span class="total-label" style="font-size: 20px; font-weight: 600;">Subtotal:</span>
                        <span class="total-value" id="subtotal" style="font-size: 24px; font-weight: 700;">R$ 0,00</span>
                    </div>
                    <div class="total-row">
                        <span class="total-label" style="font-size: 24px; font-weight: 800;">TOTAL:</span>
                        <span class="total-value" id="total" style="font-size: 40px; font-weight: 800; color: #28a745;">R$ 0,00</span>
                    </div>
                </div>

                <div class="actions-section">
                    <button class="btn btn-success" onclick="finalizarVenda()" tabindex="-1" style="font-size: 20px; padding: 20px; font-weight: 800;">
                        ‚úì FINALIZAR VENDA <span style="background: rgba(255,255,255,0.3); padding: 4px 8px; border-radius: 4px; margin-left: 10px; font-size: 14px;">F2</span>
                    </button>
                    <button class="btn btn-danger" onclick="cancelarVenda()" tabindex="-1" style="font-size: 18px; padding: 18px; font-weight: 700;">
                        ‚úï CANCELAR VENDA <span style="background: rgba(255,255,255,0.3); padding: 4px 8px; border-radius: 4px; margin-left: 10px; font-size: 14px;">F3</span>
                    </button>
                    <button class="btn btn-primary" onclick="abrirCadastro()" tabindex="-1" style="font-size: 16px; padding: 16px;">
                        + CADASTRAR PRODUTO <span style="background: rgba(255,255,255,0.3); padding: 4px 8px; border-radius: 4px; margin-left: 10px; font-size: 14px;">F4</span>
                    </button>
                    <button class="btn btn-info" onclick="abrirHistorico()" tabindex="-1" style="background: #17a2b8; border-color: #17a2b8; font-size: 16px; padding: 16px;">
                        üìä HIST√ìRICO <span style="background: rgba(255,255,255,0.3); padding: 4px 8px; border-radius: 4px; margin-left: 10px; font-size: 14px;">F5</span>
                    </button>
                    <button class="btn btn-warning" onclick="abrirGerenciarProdutos()" tabindex="-1" style="background: #ffc107; border-color: #ffc107; color: #000; font-size: 16px; padding: 16px;">
                        üì¶ PRODUTOS <span style="background: rgba(0,0,0,0.2); padding: 4px 8px; border-radius: 4px; margin-left: 10px; font-size: 14px;">F6</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- MODAIS - PRODUTOS                          -->
    <!-- ========================================== -->
    
    <!-- Modal de Cadastro de Produto -->
    <div id="cadastroModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üì¶ Cadastrar Novo Produto</h2>
            </div>
            <form id="cadastroForm" onsubmit="salvarProduto(event)">
                <div class="form-group">
                    <label>C√≥digo de Barras:</label>
                    <input type="text" id="codigoBarras" required>
                </div>
                <div class="form-group">
                    <label>Nome do Produto:</label>
                    <input type="text" id="nomeProduto" required>
                </div>
                <div class="form-group">
                    <label>Pre√ßo (R$):</label>
                    <input type="number" id="precoProduto" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                    <label>Estoque Inicial:</label>
                    <input type="number" id="estoqueProduto" min="0" value="0" required>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-success" style="flex: 1;">üíæ Salvar</button>
                    <button type="button" class="btn btn-danger" onclick="fecharModal('cadastroModal')" style="flex: 1;">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- MODAIS - VENDAS E PAGAMENTO                -->
    <!-- ========================================== -->

    <!-- Modal de Finaliza√ß√£o -->
    <div id="finalizacaoModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>üí≥ Finalizar Venda</h2>
            </div>
            <div class="total-section" style="margin-bottom: 20px;">
                <div class="total-row">
                    <span class="total-label">TOTAL A PAGAR:</span>
                    <span class="total-value" id="totalFinal" style="font-size: 32px; color: #28a745;">R$ 0,00</span>
                </div>
                <div class="total-row">
                    <span class="total-label">Valor Pago:</span>
                    <span class="total-value" id="totalPago" style="font-size: 20px; color: #007bff;">R$ 0,00</span>
                </div>
                <div class="total-row">
                    <span class="total-label">Falta Pagar:</span>
                    <span class="total-value" id="faltaPagar" style="font-size: 20px; color: #dc3545;">R$ 0,00</span>
                </div>
            </div>

            <!-- Adicionar Forma de Pagamento -->
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                <!-- Input de Valor -->
                <div class="form-group" style="margin: 0;">
                    <label style="font-size: 18px; font-weight: bold; color: #333; margin-bottom: 12px; display: block;">üí∞ Digite o Valor (R$):</label>
                    <input type="text" id="valorPagamento" placeholder="0,00" style="padding: 20px; border: 4px solid #667eea; border-radius: 10px; width: 100%; font-size: 28px; font-weight: bold; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    <p style="margin-top: 12px; text-align: center; color: #666; font-size: 14px;">Pressione <strong>Enter</strong> para selecionar a forma de pagamento</p>
                </div>
            </div>

            <!-- Lista de Pagamentos -->
            <div id="listaPagamentos" style="margin-bottom: 15px; max-height: 200px; overflow-y: auto;">
                <!-- Pagamentos ser√£o inseridos aqui -->
            </div>

            <!-- Troco (s√≥ aparece se pagar em dinheiro) -->
            <div id="trocoSection" style="display: none; background: #d4edda; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-size: 18px; font-weight: bold; color: #155724;">üí∞ TROCO:</span>
                    <span id="troco" style="font-size: 24px; font-weight: bold; color: #155724;">R$ 0,00</span>
                </div>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn btn-success" onclick="confirmarVenda()" id="btnConfirmarVenda" style="flex: 1; font-size: 18px; padding: 16px; font-weight: 800;" disabled>‚úì CONFIRMAR VENDA [Enter]</button>
                <button type="button" class="btn btn-danger" onclick="fecharModal('finalizacaoModal')" style="flex: 1; font-size: 16px; padding: 16px;">Cancelar [ESC]</button>
            </div>
        </div>
    </div>

    <!-- Modal de Sele√ß√£o de Forma de Pagamento -->
    <div id="formaPagamentoModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2 style="text-align: center; font-size: 28px;">üí≥ Selecione a Forma de Pagamento</h2>
                <p id="valorSelecionadoTexto" style="text-align: center; font-size: 24px; color: #667eea; font-weight: bold; margin-top: 10px;">Valor: R$ 0,00</p>
            </div>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; padding: 20px;">
                <!-- Dinheiro - Tecla 1 -->
                <button type="button" onclick="selecionarFormaPagamentoComValor('dinheiro')" style="
                    padding: 30px;
                    border: 4px solid #28a745;
                    background: white;
                    border-radius: 12px;
                    cursor: pointer;
                    font-size: 18px;
                    font-weight: bold;
                    transition: all 0.2s;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    gap: 10px;
                " onmouseover="this.style.background='#28a745'; this.style.color='white'" onmouseout="this.style.background='white'; this.style.color='#000'">
                    <span style="font-size: 48px;">üíµ</span>
                    <span style="font-size: 20px;">DINHEIRO</span>
                    <span style="font-size: 16px; background: #28a745; color: white; padding: 8px 16px; border-radius: 6px;">Tecla 1</span>
                </button>

                <!-- D√©bito - Tecla 2 -->
                <button type="button" onclick="selecionarFormaPagamentoComValor('debito')" style="
                    padding: 30px;
                    border: 4px solid #007bff;
                    background: white;
                    border-radius: 12px;
                    cursor: pointer;
                    font-size: 18px;
                    font-weight: bold;
                    transition: all 0.2s;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    gap: 10px;
                " onmouseover="this.style.background='#007bff'; this.style.color='white'" onmouseout="this.style.background='white'; this.style.color='#000'">
                    <span style="font-size: 48px;">üí≥</span>
                    <span style="font-size: 20px;">D√âBITO</span>
                    <span style="font-size: 16px; background: #007bff; color: white; padding: 8px 16px; border-radius: 6px;">Tecla 2</span>
                </button>

                <!-- Cr√©dito - Tecla 3 -->
                <button type="button" onclick="selecionarFormaPagamentoComValor('credito')" style="
                    padding: 30px;
                    border: 4px solid #ffc107;
                    background: white;
                    border-radius: 12px;
                    cursor: pointer;
                    font-size: 18px;
                    font-weight: bold;
                    transition: all 0.2s;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    gap: 10px;
                " onmouseover="this.style.background='#ffc107'; this.style.color='#000'" onmouseout="this.style.background='white'; this.style.color='#000'">
                    <span style="font-size: 48px;">üí≥</span>
                    <span style="font-size: 20px;">CR√âDITO</span>
                    <span style="font-size: 16px; background: #ffc107; color: #000; padding: 8px 16px; border-radius: 6px;">Tecla 3</span>
                </button>

                <!-- PIX - Tecla 4 -->
                <button type="button" onclick="selecionarFormaPagamentoComValor('pix')" style="
                    padding: 30px;
                    border: 4px solid #17a2b8;
                    background: white;
                    border-radius: 12px;
                    cursor: pointer;
                    font-size: 18px;
                    font-weight: bold;
                    transition: all 0.2s;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    gap: 10px;
                " onmouseover="this.style.background='#17a2b8'; this.style.color='white'" onmouseout="this.style.background='white'; this.style.color='#000'">
                    <span style="font-size: 48px;">üì±</span>
                    <span style="font-size: 20px;">PIX</span>
                    <span style="font-size: 16px; background: #17a2b8; color: white; padding: 8px 16px; border-radius: 6px;">Tecla 4</span>
                </button>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-danger" onclick="fecharModalFormaPagamento()" style="width: 100%; font-size: 16px;">Cancelar [ESC]</button>
            </div>
        </div>
    </div>

    <!-- Modal de Confirma√ß√£o de Venda Completa -->
    <div id="confirmacaoVendaModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div style="text-align: center; padding: 20px;">
                <div style="font-size: 80px; margin-bottom: 20px; animation: bounce 1s infinite;">‚úì</div>
                <h2 style="color: #28a745; font-size: 32px; margin-bottom: 15px;">Pagamento Completo!</h2>
                <p style="font-size: 20px; color: #666; margin-bottom: 10px;">Total pago:</p>
                <p id="totalPagoConfirmacao" style="font-size: 36px; font-weight: bold; color: #28a745; margin-bottom: 10px;">R$ 0,00</p>
                <div id="trocoConfirmacao" style="display: none; background: #fff3cd; padding: 15px; border-radius: 8px; margin: 20px 0;">
                    <p style="font-size: 18px; color: #856404; margin-bottom: 5px;">üí∞ Troco:</p>
                    <p id="trocoValorConfirmacao" style="font-size: 28px; font-weight: bold; color: #856404;">R$ 0,00</p>
                </div>
            </div>
            <div class="modal-actions" style="gap: 15px;">
                <button type="button" class="btn btn-success" onclick="confirmarVendaFinal()" style="flex: 1; font-size: 20px; padding: 20px; font-weight: 800; animation: pulse 1.5s infinite;">‚úì CONFIRMAR [Enter]</button>
                <button type="button" class="btn btn-danger" onclick="cancelarConfirmacaoVenda()" style="flex: 1; font-size: 18px; padding: 20px;">‚úï Cancelar [ESC]</button>
            </div>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- MODAIS - CAIXA                             -->
    <!-- ========================================== -->

    <!-- Modal de Menu do Caixa -->
    <div id="menuCaixaModal" class="modal">
        <div class="modal-content" style="max-width: 500px;" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>üí∞ Gerenciar Caixa</h2>
                <p id="saldoCaixaTexto" style="margin-top: 10px; font-size: 18px; color: #666;">Saldo Atual: <strong style="color: #28a745;">R$ 0,00</strong></p>
            </div>
            <div style="display: flex; flex-direction: column; gap: 15px; padding: 20px;">
                <button type="button" onclick="abrirModalAberturaCaixa()" id="btnAbrirCaixa" class="btn btn-success" style="font-size: 18px; padding: 18px;">
                    üîì Abrir Caixa
                </button>
                <button type="button" onclick="abrirModalReforcoCaixa()" id="btnReforcoCaixa" class="btn btn-primary" style="font-size: 18px; padding: 18px;" disabled>
                    üíµ Refor√ßo de Caixa
                </button>
                <button type="button" onclick="abrirModalSangria()" id="btnSangria" class="btn btn-warning" style="font-size: 18px; padding: 18px; background: #ff9800; border-color: #ff9800;" disabled>
                    üìâ Sangria
                </button>
                <button type="button" onclick="abrirModalFechamentoCaixa()" id="btnFecharCaixa" class="btn btn-danger" style="font-size: 18px; padding: 18px;" disabled>
                    üîí Fechar Caixa
                </button>
                <hr style="margin: 10px 0; border: none; border-top: 1px solid #ddd;">
                <button type="button" onclick="abrirHistoricoFechamentos()" class="btn btn-info" style="font-size: 18px; padding: 18px; background: #6c757d; border-color: #6c757d;">
                    üìä Hist√≥rico de Fechamentos
                </button>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-primary" onclick="fecharModal('menuCaixaModal')" style="width: 100%;">Voltar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Abertura de Caixa -->
    <div id="aberturaCaixaModal" class="modal modal-nested">
        <div class="modal-content" style="max-width: 500px;" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>üîì Abertura de Caixa</h2>
            </div>
            <form onsubmit="confirmarAberturaCaixa(event)">
                <div class="form-group">
                    <label>Valor Inicial (R$):</label>
                    <input type="number" id="valorAbertura" step="0.01" min="0" placeholder="0.00" required style="font-size: 24px; text-align: center; font-weight: bold;">
                </div>
                <div class="form-group">
                    <label>Operador:</label>
                    <input type="text" id="operadorAbertura" placeholder="Nome do operador" required>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-success" style="flex: 1; font-size: 18px; padding: 16px;">‚úì Abrir Caixa</button>
                    <button type="button" class="btn btn-danger" onclick="fecharModalAninhado(event, 'aberturaCaixaModal')" style="flex: 1;">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Refor√ßo de Caixa -->
    <div id="reforcoCaixaModal" class="modal modal-nested">
        <div class="modal-content" style="max-width: 500px;" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>üíµ Refor√ßo de Caixa</h2>
                <p style="margin-top: 10px; color: #666;">Adicionar dinheiro ao caixa</p>
            </div>
            <form onsubmit="confirmarReforcoCaixa(event)">
                <div class="form-group">
                    <label>Valor do Refor√ßo (R$):</label>
                    <input type="number" id="valorReforco" step="0.01" min="0.01" placeholder="0.00" required style="font-size: 24px; text-align: center; font-weight: bold;">
                </div>
                <div class="form-group">
                    <label>Observa√ß√£o:</label>
                    <input type="text" id="observacaoReforco" placeholder="Motivo do refor√ßo (opcional)">
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-success" style="flex: 1; font-size: 18px; padding: 16px;">‚úì Confirmar Refor√ßo</button>
                    <button type="button" class="btn btn-danger" onclick="fecharModalAninhado(event, 'reforcoCaixaModal')" style="flex: 1;">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Sangria -->
    <div id="sangriaModal" class="modal modal-nested">
        <div class="modal-content" style="max-width: 500px;" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>üìâ Sangria</h2>
                <p style="margin-top: 10px; color: #666;">Retirar dinheiro do caixa</p>
            </div>
            <form onsubmit="confirmarSangria(event)">
                <div class="form-group">
                    <label>Valor da Sangria (R$):</label>
                    <input type="number" id="valorSangria" step="0.01" min="0.01" placeholder="0.00" required style="font-size: 24px; text-align: center; font-weight: bold;">
                </div>
                <div class="form-group">
                    <label>Observa√ß√£o:</label>
                    <input type="text" id="observacaoSangria" placeholder="Motivo da sangria" required>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-warning" style="flex: 1; font-size: 18px; padding: 16px; background: #ff9800; border-color: #ff9800;">‚úì Confirmar Sangria</button>
                    <button type="button" class="btn btn-danger" onclick="fecharModalAninhado(event, 'sangriaModal')" style="flex: 1;">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Fechamento de Caixa -->
    <div id="fechamentoCaixaModal" class="modal modal-nested">
        <div class="modal-content" style="max-width: 600px;" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>üîí Fechamento de Caixa</h2>
            </div>
            <div style="padding: 20px; background: #f8f9fa; border-radius: 8px; margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #ddd;">
                    <span style="font-weight: 600;">Valor Abertura:</span>
                    <span id="fechValorAbertura" style="font-weight: bold; color: #007bff;">R$ 0,00</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #ddd;">
                    <span style="font-weight: 600;">Total em Vendas:</span>
                    <span id="fechTotalVendas" style="font-weight: bold; color: #28a745;">R$ 0,00</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #ddd;">
                    <span style="font-weight: 600;">Refor√ßos:</span>
                    <span id="fechReforcos" style="font-weight: bold; color: #17a2b8;">R$ 0,00</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #ddd;">
                    <span style="font-weight: 600;">Sangrias:</span>
                    <span id="fechSangrias" style="font-weight: bold; color: #ff9800;">R$ 0,00</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 15px 0; padding-top: 15px; margin-top: 10px; border-top: 2px solid #667eea;">
                    <span style="font-size: 20px; font-weight: 800;">SALDO ESPERADO:</span>
                    <span id="fechSaldoEsperado" style="font-size: 24px; font-weight: 800; color: #667eea;">R$ 0,00</span>
                </div>
            </div>
            <form onsubmit="confirmarFechamentoCaixa(event)">
                <div class="form-group">
                    <label>Valor Real em Caixa (R$):</label>
                    <input type="number" id="valorFechamento" step="0.01" min="0" placeholder="0.00" required style="font-size: 24px; text-align: center; font-weight: bold;">
                </div>
                <div id="diferencaFechamento" style="display: none; padding: 15px; border-radius: 8px; margin-bottom: 15px; text-align: center;">
                    <p style="font-size: 18px; font-weight: bold;"></p>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-danger" style="flex: 1; font-size: 18px; padding: 16px;">‚úì Fechar Caixa</button>
                    <button type="button" class="btn btn-primary" onclick="fecharModalAninhado(event, 'fechamentoCaixaModal')" style="flex: 1;">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Hist√≥rico de Fechamentos -->
    <div id="historicoFechamentosModal" class="modal modal-nested">
        <div class="modal-content" style="max-width: 900px;" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>üìä Hist√≥rico de Fechamentos de Caixa</h2>
            </div>
            
            <!-- Filtros -->
            <div style="background: #f8f9fa; padding: 15px; margin-bottom: 15px; border-radius: 8px;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                        <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 14px;">üìÖ Per√≠odo:</label>
                        <select id="filtroPeriodo" onchange="aplicarFiltrosHistorico()" style="width: 100%; padding: 8px; border-radius: 6px; border: 2px solid #ddd; font-size: 14px;">
                            <option value="todos">Todos</option>
                            <option value="hoje">Hoje</option>
                            <option value="ultimos7">√öltimos 7 dias</option>
                            <option value="ultimos30">√öltimos 30 dias</option>
                            <option value="personalizado">Per√≠odo personalizado</option>
                        </select>
                    </div>
                    
                    <div>
                        <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 14px;">üë§ Operador:</label>
                        <select id="filtroOperador" onchange="aplicarFiltrosHistorico()" style="width: 100%; padding: 8px; border-radius: 6px; border: 2px solid #ddd; font-size: 14px;">
                            <option value="todos">Todos</option>
                        </select>
                    </div>
                    
                    <div>
                        <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 14px;">üìä Status:</label>
                        <select id="filtroStatus" onchange="aplicarFiltrosHistorico()" style="width: 100%; padding: 8px; border-radius: 6px; border: 2px solid #ddd; font-size: 14px;">
                            <option value="todos">Todos</option>
                            <option value="correto">‚úì Correto</option>
                            <option value="sobra">üí∞ Com Sobra</option>
                            <option value="falta">‚ö†Ô∏è Com Falta</option>
                        </select>
                    </div>
                </div>
                
                <!-- Datas personalizadas (inicialmente oculto) -->
                <div id="datasPersonalizadas" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 2px solid #ddd;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 14px;">De:</label>
                            <input type="date" id="dataInicio" onchange="aplicarFiltrosHistorico()" style="width: 100%; padding: 8px; border-radius: 6px; border: 2px solid #ddd; font-size: 14px;">
                        </div>
                        <div>
                            <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 14px;">At√©:</label>
                            <input type="date" id="dataFim" onchange="aplicarFiltrosHistorico()" style="width: 100%; padding: 8px; border-radius: 6px; border: 2px solid #ddd; font-size: 14px;">
                        </div>
                    </div>
                </div>
                
                <button onclick="limparFiltrosHistorico()" style="margin-top: 15px; padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">
                    üîÑ Limpar Filtros
                </button>
            </div>
            
            <div id="historicoFechamentosContent" style="max-height: 500px; overflow-y: auto; padding: 10px;">
                <p style="text-align: center; color: #666; padding: 20px;">Carregando hist√≥rico...</p>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-danger" onclick="limparHistoricoFechamentos()" style="flex: 1;">üóëÔ∏è Limpar Hist√≥rico</button>
                <button type="button" class="btn btn-primary" onclick="fecharModalAninhado(event, 'historicoFechamentosModal')" style="flex: 1;">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Detalhes do Fechamento -->
    <div id="detalhesFechamentoModal" class="modal modal-nested-level-2">
        <div class="modal-content" style="max-width: 700px;" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>üìä Detalhes do Fechamento</h2>
            </div>
            <div id="detalhesFechamentoContent" style="max-height: 500px; overflow-y: auto; padding: 20px;">
                <!-- Conte√∫do ser√° preenchido dinamicamente -->
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-primary" onclick="fecharModalAninhado(event, 'detalhesFechamentoModal')" style="width: 100%;">Voltar</button>
            </div>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- MODAIS - DIVERSOS                          -->
    <!-- ========================================== -->

    <!-- Modal de Ajuda -->
    <div id="ajudaModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>‚å®Ô∏è Atalhos de Teclado</h2>
            </div>
            <div style="line-height: 2;">
                <p><kbd>ENTER</kbd> - Adicionar produto ao carrinho</p>
                <p><kbd>F1</kbd> - Abrir esta ajuda</p>
                <p><kbd>F2</kbd> - Finalizar venda</p>
                <p><kbd>F3</kbd> - Cancelar venda atual</p>
                <p><kbd>F4</kbd> - Cadastrar novo produto</p>
                <p><kbd>F5</kbd> - Ver hist√≥rico de vendas</p>
                <p><kbd>F6</kbd> - Gerenciar produtos</p>
                <p><kbd>ESC</kbd> - Fechar modal/di√°logo</p>
                <hr style="margin: 15px 0;">
                <p><strong>üí° Dica:</strong> O leitor de c√≥digo de barras funciona como teclado! Basta escanear e o produto ser√° adicionado automaticamente.</p>
                <p><strong>üîå Status:</strong> Conectado ao banco MySQL</p>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-primary" onclick="fecharModal('ajudaModal')" style="width: 100%;">Entendi</button>
            </div>
        </div>
    </div>

    <!-- Modal de Lista de Produtos -->
    <div id="produtosModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2>üì¶ Gerenciar Produtos</h2>
            </div>
            
            <!-- Filtros -->
            <div style="background: #f8f9fa; padding: 15px; margin-bottom: 15px; border-radius: 8px;">
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 15px; margin-bottom: 10px;">
                    <div>
                        <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 14px;">üîç Buscar:</label>
                        <input type="text" id="filtroBuscaProduto" placeholder="Nome ou c√≥digo de barras..." onkeyup="aplicarFiltrosProdutos()" style="width: 100%; padding: 10px; border-radius: 6px; border: 2px solid #ddd; font-size: 14px;">
                    </div>
                    
                    <div>
                        <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 14px;">üìä Status:</label>
                        <select id="filtroStatusProduto" onchange="aplicarFiltrosProdutos()" style="width: 100%; padding: 10px; border-radius: 6px; border: 2px solid #ddd; font-size: 14px;">
                            <option value="todos">Todos</option>
                            <option value="ativo">‚úì Ativos</option>
                            <option value="inativo">‚úó Inativos</option>
                            <option value="com_estoque">üì¶ Com Estoque</option>
                            <option value="sem_estoque">‚ö†Ô∏è Sem Estoque</option>
                        </select>
                    </div>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <button onclick="limparFiltrosProdutos()" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">
                        üîÑ Limpar Filtros
                    </button>
                    <span id="contadorProdutos" style="font-size: 14px; color: #666; font-weight: 600;"></span>
                </div>
            </div>
            
            <div id="produtosContent" style="max-height: 400px; overflow-y: auto; margin-bottom: 15px;">
                <p style="text-align: center; color: #666; padding: 20px;">Carregando produtos...</p>
            </div>
            
            <!-- Pagina√ß√£o -->
            <div id="paginacaoProdutos" style="display: flex; justify-content: center; align-items: center; gap: 10px; padding: 15px; background: #f8f9fa; border-radius: 8px; margin-bottom: 15px;">
            </div>
            
            <div class="modal-actions">
                <button type="button" class="btn btn-primary" onclick="fecharModal('produtosModal')" style="width: 100%;">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Edi√ß√£o de Produto -->
    <div id="editarProdutoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚úèÔ∏è Editar Produto</h2>
            </div>
            <form id="editarForm" onsubmit="salvarEdicaoProduto(event)">
                <input type="hidden" id="editarId">
                <div class="form-group">
                    <label>C√≥digo de Barras:</label>
                    <input type="text" id="editarCodigoBarras" readonly style="background: #f8f9fa; color: #666;">
                </div>
                <div class="form-group">
                    <label>Nome do Produto:</label>
                    <input type="text" id="editarNome" required>
                </div>
                <div class="form-group">
                    <label>Pre√ßo (R$):</label>
                    <input type="number" id="editarPreco" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                    <label>Estoque:</label>
                    <input type="number" id="editarEstoque" min="0" required>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-success" style="flex: 1;">üíæ Salvar Altera√ß√µes</button>
                    <button type="button" class="btn btn-danger" onclick="fecharModalEdicao()" style="flex: 1;">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Hist√≥rico de Vendas -->
    <div id="historicoModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2>üìä Hist√≥rico de Vendas</h2>
            </div>
            
            <!-- Filtros -->
            <div style="padding: 15px; background: #f8f9fa; border-radius: 8px; margin-bottom: 15px;">
                <div style="display: grid; gap: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">üìÖ Per√≠odo:</label>
                        <select id="filtroPeriodoVendas" onchange="aplicarFiltrosVendas()" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
                            <option value="hoje">Hoje</option>
                            <option value="7dias">√öltimos 7 dias</option>
                            <option value="30dias">√öltimos 30 dias</option>
                            <option value="todos">Todos</option>
                        </select>
                    </div>
                </div>
                <div style="margin-top: 10px; text-align: right;">
                    <span id="contadorVendas" style="color: #666; font-size: 14px;">0 venda(s) encontrada(s)</span>
                </div>
            </div>
            
            <div id="historicoContent" style="max-height: 500px; overflow-y: auto;">
                <p style="text-align: center; color: #666; padding: 20px;">Carregando vendas...</p>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-primary" onclick="fecharModal('historicoModal')" style="width: 100%;">Fechar</button>
            </div>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- MODAIS - CONFIGURA√á√ïES                     -->
    <!-- ========================================== -->

    <!-- Modal de Configura√ß√µes -->
    <div id="configuracoesModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2>‚öôÔ∏è Configura√ß√µes do Sistema</h2>
            </div>
            <div style="padding: 20px;">
                <h3 style="color: #333; margin-bottom: 15px; border-bottom: 2px solid #ddd; padding-bottom: 10px;">üí∞ Alertas de Caixa</h3>
                
                <div class="form-group">
                    <label style="font-weight: bold; font-size: 16px;">Tipo de Alerta:</label>
                    <select id="configTipoAlerta" style="width: 100%; padding: 10px; font-size: 15px; border: 2px solid #ddd; border-radius: 6px;">
                        <option value="dia_diferente">üóìÔ∏è Alertar se o caixa foi aberto em dia diferente</option>
                        <option value="horas">‚è∞ Alertar ap√≥s X horas de caixa aberto</option>
                        <option value="desabilitado">üö´ Desabilitar alertas</option>
                    </select>
                </div>

                <div id="configHorasContainer" class="form-group" style="display: none;">
                    <label style="font-weight: bold; font-size: 16px;">Horas para Alertar:</label>
                    <input type="number" id="configHorasAlerta" min="1" max="168" value="24" style="width: 100%; padding: 10px; font-size: 15px; border: 2px solid #ddd; border-radius: 6px;">
                    <small style="color: #666;">Entre 1 e 168 horas (1 semana)</small>
                </div>

                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 20px; border-left: 4px solid #17a2b8;">
                    <strong>‚ÑπÔ∏è Informa√ß√µes:</strong>
                    <ul style="margin: 10px 0 0 20px; color: #555;">
                        <li><strong>Dia diferente:</strong> Alerta ser√° exibido se o caixa foi aberto ontem ou antes</li>
                        <li><strong>Horas:</strong> Alerta ser√° exibido ap√≥s o tempo especificado (ex: 24h)</li>
                        <li><strong>Desabilitado:</strong> Nenhum alerta ser√° exibido</li>
                    </ul>
                </div>
            </div>
            <div class="modal-actions" style="padding: 0 20px 20px;">
                <button type="button" class="btn btn-success" onclick="salvarConfiguracoes()" style="flex: 1; font-size: 16px; padding: 14px;">
                    üíæ Salvar Configura√ß√µes
                </button>
                <button type="button" class="btn btn-secondary" onclick="fecharModal('configuracoesModal')" style="flex: 1; font-size: 16px; padding: 14px; background: #6c757d; border-color: #6c757d;">
                    ‚úñÔ∏è Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Notifica√ß√£o -->
    <div id="notification" class="notification"></div>

    <script src="js/utils.js"></script>
    <script src="js/modal-handler.js"></script>
    <script src="js/configuracoes.js"></script>
    <script src="js/caixa.js"></script>
    <script src="js/historico.js"></script>
    <script src="js/produtos.js"></script>
    <script src="js/pdv.js"></script>
</body>
</html>
